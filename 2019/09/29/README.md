# 2019.09.29

本周将更多的经历放在了课堂内容上，在课后对课堂的内容进行了复习，因此自己学习的内容较少，To-Do 完成的情况较差，下周需要对自己的节奏进行调整。

## 课堂内容

首先，在**操作系统**课程上，学习的内容如下：

本周主要学习了在操作系统开始创建进程 1，初始化了 `task_struct` 等数据结构之后，开始为进程 1 建立分段机制和分页机制。对分段机制的建立，即对 LDT 数据结构中的代码段和数据段描述符进行设置（实际上也是复制的父进程的），这个时候可以完成逻辑地址到线性地址的映射（即可以通过段选择子结合段内偏移得到线性地址），接下来需要完成分页机制的建立，开始创建进程 1 的页表，同时复制父进程（即进程 0）的前几个页表项，这个时候进程 1 的分段和分页机制完成。

之后，在 GDT 中设置好进程 1 的 LDT 和 TSS 项，然后将进程 1 的状态设置为就绪状态，即完成进程 1 的创建。

在创建完进程 1 之后，此时还处在进程 0 的内核态，因此会从内核态返回，最终回到 main 函数中调用 fork 函数的后一句语句。之后会进入 main 函数的最后一个部分：

```c
for(;;) pause();
```

其中，pause 函数即进行进程调度。pause 函数进行进程调度时，同样调用系统调用，通过系统调用来完成，首先找到可执行的 task（进程），然后通过 ljmp 跳转到对应指令，该指令同样是之前 fork 函数后面的一句，因为目的地址的 EIP 寄存器是由创建进程 1 时写入的，此时 fork 的返回值是 0，因此进入 setup 函数进行调用，这个时候就已经由进程 0 调度到 进程 1 了，接下来的工作开始由进程 1 进行。

之后是**计算机体系结构**的课程，由于国庆假期调课，本周上了两节体系结构。第一节讲解了指令系统结构的发展，各个指令系统的异同以及特点，之后着重介绍了 RISC 指令系统的特点。在第二节课堂上，讲解了静态流水线。老师通过向我们讲解一个简单的 MIPS 指令集的 CPU 结构的实现历史，来向我们逐一讲解 CPU 是如何一步一步从数据通路、控制通路、时序等到发展出 5 级流水线，同时也介绍了由于流水线所带来的一些问题和相应的解决办法。

在 **Web 安全技术**课堂上，主要讲解了 XSS 与 CSRF 漏洞的原理和利用，其中 XSS 主要介绍了反射型 XSS，存储型 XSS 以及 DOM 型 XSS。同时，还介绍了一些客户端进行 XSS 攻击的例子。此外，老师还介绍了 Click Jacking 攻击，通过几个例子，让我们有了大致的了解。

在**算法**课堂上，仍然围绕着**分治**的思想，由快排的思想讲解了解决寻找第 K 小的元素的问题，然后讲解了采样的技术，将一个大的样本，提取出部分小的样本，从而使得在小的样本上可以完成一些复杂的工作但是不会增加过多的时间复杂度。之后，继续讲解了寻找空间中最近的两个点的基本解决方法以及相应的优化思想。同样，由于国庆假期调课，本周仍然有两节算法课，继续学习了使用分治的思想，借用傅立叶变换和快速傅立叶变换的方法，对一个多项式的求解也分成子问题，并由解决多项式求解的问题引申出计算两个数字的乘法。最后的时间，课上讲解了动态规划算法的基本思想，将原问题构造成多步决策问题。

此外，本周还利用课余时间将自然语言处理课程的数学基础部分进行了巩固。主要是用到了概率论和信息论的一些基本知识，以及通过使用概率论（贝叶斯分类器）或信息论（最大熵模型）等方法对歧义词问题进行解决。

此外，还有一些研讨课、非专业课以及与安全方面相关不大的专业课，暂不列举。

## 课后内容

本周首先完成了组里的任务，对 6 个 CTF 题目的 Write Up 内容进行提取，划分。

本周原计划实现上周提到的二进制程序从 16-bit 模式到保护模式的转变，但是由于对任务划分时间没有规划好，导致没有时间去完成，看看下周能不能将这个部分重新完成。

之后，对上周提到的 **Type Confusion** 类型漏洞进行研究，大致了解了该类型漏洞的[基本原理](https://github.com/lcyfrank/Week/blob/master/2019/09/29/type_confusion.md)，但是感觉想要灵活利用这种漏洞，需要对对应浏览器使用的 JavaScript 引擎有一个更深入的了解，尤其是内部对象的组织形式，因此下周计划学习一下*V8 引擎*内部实现原理。

然后，看了一篇[真实的漏洞分析](https://research.securitum.com/dompurify-bypass-using-mxss/)（虽然原计划是看 5 篇），比较巧的是和本周 Web 安全技术的课程内容有关，其借助了一个 DOMPurify 的逻辑漏洞，在 DOMPurify 中，会对一些 DOM 元素和属性（在建成 DOM Tree 之后）进行过滤。但是由于 svg 元素存在的一些规则，从而使得这种过滤机制会被绕过。svg 元素的规则（个人总结）：\<svg\>\</p\> …… 的时候，会被修改成为 \<svg\>\<p\>\</p\>…\</svg\>，而再用 \<svg\>\<p\>\</p\>…\</svg\> 赋值给 DOM 元素的时候，会被修改成为 \<svg\>\</svg\>\<p\>\</p\>…，这时再借助 style 元素，当该元素在 svg 元素内部的时候，子元素会被解析成为 DOM Tree。而当其不在 svg 标签内的时候，子元素会被当作纯文本看待。构造出如下的绕过 DOM 串：

```html
<svg>
</p>
<style>
<g title="</style><img src onerror=alert(1)>">
```

## 总结

以上就是本周大体的学习内容。

本周由于课程作业较多，以及自己的一些事情，完成的计划内容较少。本周感觉自己的学习效率仍然较低，此外，对上周提到的前卫分析文章分析也比较少，需要对自己的时间规划做出一个调整。
